---
output: github_document
bibliography: vignettes/references.json
link-citations: true
---

<!-- README.md is generated from README.Rmd. Please edit that file. -->
<!-- The code to render this README is stored in .github/workflows/render-readme.yaml -->
<!-- Variables marked with double curly braces will be transformed beforehand: -->
<!-- `packagename` is extracted from the DESCRIPTION file -->
<!-- `gh_repo` is extracted via a special environment variable in GitHub Actions -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse  = TRUE,
  comment   = "#>",
  fig.path  = file.path("man", "figures", "README-"),
  out.width = "100%"
)
```

# _{{ packagename }}_: Methods for simulating and analysing the size and length of transmission chains from branching process models <img src="man/figures/logo.svg" align="right" height="130" />

<!-- badges: start -->
![GitHub R package version](https://img.shields.io/github/r-package/v/epiverse-trace/epichains)
[![R-CMD-check](https://github.com/epiverse-trace/epichains/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/epiverse-trace/epichains/actions/workflows/R-CMD-check.yaml)
[![codecov](https://codecov.io/github/epiverse-trace/epichains/branch/main/graphs/badge.svg)](https://codecov.io/github/epiverse-trace/epichains)
![GitHub contributors](https://img.shields.io/github/contributors/epiverse-trace/epichains)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Lifecycle:
experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
<!-- badges: end -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

_{{ packagename }}_ is an R package to simulate, analyse, and visualize the size 
and length of branching processes with a given offspring distribution. These 
models are often used in infectious disease epidemiology, where the chains represent chains of transmission, and the offspring distribution represents the distribution of secondary infections caused by an infected individual. 

_{{ packagename }}_ re-implements [bpmodels]("https://github.com/epiverse-trace/bpmodels/")
by providing bespoke functions and data structures that allow easy
manipulation and interoperability with other Epiverse-TRACE packages, for example, [superspreading]("https://github.com/epiverse-trace/superspreading/") and [epiparameter]("https://github.com/epiverse-trace/epiparameter/"), and potentially some already existing packages for handling transmission chains, for example, [epicontacts](https://github.com/reconhub/epicontacts).

_{{ packagename }}_ is developed at the [Centre for the Mathematical Modelling of Infectious Diseases](https://www.lshtm.ac.uk/research/centres/centre-mathematical-modelling-infectious-diseases) at the London School of Hygiene and Tropical Medicine as part of the [Epiverse Initiative](https://data.org/initiatives/epiverse/).

## Installation

The latest development version of the _{{ packagename }}_ package can be installed via

```{r include=TRUE, eval=FALSE}
# check whether {pak} is installed
if (!require("pak")) install.packages("pak")
# install {epichains}
pak::pak("{{ gh_repo }}")
```

To load the package, use

```{r eval=TRUE}
library("epichains")
```

## Quick start

_{{ packagename }}_ provides four main functions:

* `simulate_tree()`: simulates transmission chains using an initial number of
cases and information on the offspring distribution. This function returns
an object of type `data frame` with 5 columns that track information on who infected whom, the generation of infection and, if a generation time function is specified, the time of infection.

```{r eval=FALSE}
set.seed(123)
chains <- simulate_tree(
  ntrees          = 10,
  statistic       = "size",
  offspring_dist  = "pois",
  stat_max        = 10,
  generation_time = function(n) rep(3, n),
  lambda          = 2
)
```

* `simulate_summary()`: simulates a vector of transmission chain sizes or
lengths using an initial number of cases and information on the offspring
distribution. This function only returns a vector of realized chain size or length.

```{r eval=FALSE}
simulate_summary(
  ntrees         = 10,
  statistic      = "size",
  offspring_dist = "pois",
  stat_max       = 10,
  lambda         = 2
)
```

* `simulate_tree_from_pop()`: simulates transmission chains given an initial
population size and information on the offspring distribution. You can also
specify a given level of pre-existing immunity. This function returns
an object of type `data frame` with 4 columns that track information on who infected whom, the generation of infection and, if a generation time function is given, the
time of infection.

```{r eval=FALSE}
# SIMULATE WITH POISSON OFFSPRING
simulate_tree_from_pop(
  pop             = 100,
  offspring_dist  = "pois",
  lambda          = 0.5,
  generation_time = function(n) rep(3, n)
)

# SIMULATE WITH NEGATIVE BINOMIAL OFFSPRING
simulate_tree_from_pop(
  pop             = 100,
  offspring_dist  = "nbinom",
  mu              = 0.5,
  size            = 1.1,
  generation_time = function(n) rep(3, n)
)
```

* `likelihood()`: calculates the log likelihood (or likelihood, depending
on the value of `log`) of observing a vector of transmission chain sizes or
lengths.

```{r eval=FALSE}
set.seed(121)
# RANDOMLY GENERATE 20 CHAINS OF SIZE 1 TO 10
chain_sizes <- sample(1:10, 20, replace = TRUE)
likelihood(
  chains         = chain_sizes,
  statistic      = "size",
  offspring_dist = "pois",
  nsim_obs       = 100,
  lambda         = 0.5
)
```

The objects returned by the `simulate_*()` functions can be summarized with
`summary()` and aggregated into a `<data.frame>` of cases per time or generation
with `aggregate()`. Aggregated results can also be passed on to `plot()` with
its own arguments to customize the resulting plots. 

Each of the listed functionalities is demonstrated in detail
in the ["Getting Started" vignette](https://epiverse-trace.github.io/epichains/articles/epichains.html).

## Package vignettes

The theory behind the models provided here can be
found in the [theory vignette](https://epiverse-trace.github.io/epichains/articles/theoretical_background.html).

We have also collated a bibliography of branching process applications in 
epidemiology. These can be found in the [literature vignette](https://epiverse-trace.github.io/epichains/articles/branching_process_literature.html).

Specific use cases of _{{ packagename }}_ can be found in 
the [online documentation as package vignettes](https://epiverse-trace.github.io/epichains/), under "Articles".

## Reporting bugs 

To report a bug please open an [issue](https://github.com/epiverse-trace/epichains/issues/new/choose).

## Contribute

We welcome contributions to enhance the package's functionalities. If you 
wish to do so, please follow the [package contributing guide](https://github.com/epiverse-trace/epichains/blob/main/.github/CONTRIBUTING.md).

## Code of conduct

Please note that the _{{ packagename }}_ project is released with a [Contributor Code of Conduct](https://github.com/epiverse-trace/.github/blob/main/CODE_OF_CONDUCT.md). 
By contributing to this project, you agree to abide by its terms.

## Citing this package

```{r message=FALSE, warning=FALSE}
citation("epichains")
```
