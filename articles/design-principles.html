<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Design Principles for {epichains} • epichains</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Design Principles for {epichains}">
<!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XZ471458FQ"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XZ471458FQ');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">
    <a href="https://epiverse-trace.github.io/" class="external-link"><img src="https://epiverse-trace.github.io/blueprints/logo_white.svg" id="logo" alt="Epiverse-TRACE"></a>
    <a class="navbar-brand me-2" href="../index.html">epichains</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/epichains.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Package vignettes</h6></li>
    <li><a class="dropdown-item" href="../articles/projecting_incidence.html">Projecting infectious disease incidence: a COVID-19 example</a></li>
    <li><a class="dropdown-item" href="../articles/interventions.html">Modelling disease control interventions</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Modelling guides and background</h6></li>
    <li><a class="dropdown-item" href="../articles/branching_process_literature.html">Literature on branching process applications</a></li>
    <li><a class="dropdown-item" href="../articles/theoretical_background.html">Theoretical background for epichains</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Developer Documentation</h6></li>
    <li><a class="dropdown-item" href="../articles/design-principles.html">Design Principles for {epichains}</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiverse-trace/epichains/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Design Principles for {epichains}</h1>
            <h3 data-toc-skip class="subtitle">An R package for
simulating, handling, and analysing transmission chains in R</h3>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epiverse-trace/epichains/blob/main/vignettes/design-principles.Rmd" class="external-link"><code>vignettes/design-principles.Rmd</code></a></small>
      <div class="d-none name"><code>design-principles.Rmd</code></div>
    </div>

    
    
<p>This vignette outlines the design decisions that have been taken
during the development of the <a href="https://github.com/epiverse-trace/epichains" class="external-link">epichains</a> R package, and
provides some of the reasoning, and possible pros and cons of each
decision.</p>
<p>The goal here is to make it easy to acquaint oneself with the code
base in the absence of the current maintainer. This will ease future
contributions and maintenance of the package.</p>
<div class="section level2">
<h2 id="scope">Scope<a class="anchor" aria-label="anchor" href="#scope"></a>
</h2>
<p>{epichains} aims to facilitate:</p>
<ul>
<li>Simulation of transmission chains using branching processes
methods,</li>
<li>Handling of transmission chains using objected-orientated design,
and</li>
<li>Estimation of the likelihood of observing transmission chain
summaries (sizes or lengths). This can be achieved in two ways:
<ul>
<li>Analytical/closed-form likelihoods that take the form
<code>&lt;distribution&gt;_&lt;chain_statistic_type&gt;_ll&gt;</code>,
for example, <code>gborel_size_ll()</code> and
<code>pois_length_ll()</code>.</li>
<li>Numerical likelihood simulation using
<code>offspring_ll()</code>.</li>
</ul>
</li>
</ul>
<p>Additionally, the package provides mixture probability distributions
for generating offspring distributions, for example,
<code><a href="../reference/rborel.html">rborel()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="design-decisions">Design decisions<a class="anchor" aria-label="anchor" href="#design-decisions"></a>
</h2>
<div class="section level3">
<h3 id="simulation-functions">Simulation functions<a class="anchor" aria-label="anchor" href="#simulation-functions"></a>
</h3>
<p>Simulation of branching processes are achieved through
<code><a href="../reference/simulate_chains.html">simulate_chains()</a></code> and <code><a href="../reference/simulate_chain_stats.html">simulate_chain_stats()</a></code>.
For details of the underlying methods, see the <a href="https://epiverse-trace.github.io/epichains/articles/theoretical_background.html">theory
vignette</a>.</p>
<p>The simulations are stochastic, meaning that one set of inputs can
produce varied results. The models here can also be use to explore
scenario analyses by varying the inputs. Often, in cases where there is
need for more than one run of the model and/or with more than one set of
parameter values, the inputs and outputs are stored in separate data
structures. However, this approach can be limiting when performing
scenario analyses, as the user has to manually manipulate the two
objects with reshaping and joining operations. This has the potential to
lead to errors and loss of information. Hence,
<code><a href="../reference/simulate_chains.html">simulate_chains()</a></code> and <code><a href="../reference/simulate_chain_stats.html">simulate_chain_stats()</a></code>
return objects of the dedicated classes <code>&lt;epichains&gt;</code>
and <code>&lt;epichains_summary&gt;</code> respectively that store the
input parameters and the output of the simulation in a single
object.</p>
<p>The <code>&lt;epichains&gt;</code> class extends the
<code>&lt;data.frame&gt;</code>, using columns to store information
about the simulated transmission chains and the parameter values as
attributes. <code>&lt;data.frame&gt;</code> was chosen because its
tabular structure allows us to store information in rows and columns,
and is a widely used data structure in R. Similarly, the
<code>&lt;epichains_summary&gt;</code> class is a superclass (an
extension) of R’s <code>&lt;numeric&gt;</code> class and stores the
parameter values as attributes.</p>
<p>The <code>&lt;epichains&gt;</code> object contains information about
the whole outbreak, but key summaries are not easily deduced from a
quick glance of the object. Hence, the class has a dedicated
<code>format()/print()</code> method to print the simulated transmission
chains in a manner similar to a <code>&lt;dataframe&gt;</code>, but
accompanied by extra summary information including the number of chains
simulated, number of generations reached, and the number of infectors
created. These summaries are useful for quickly assessing the output of
the simulation.</p>
<p>Importantly, the <code>&lt;epichains&gt;</code> class has a
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> method that returns an
<code>&lt;epichains_summary&gt;</code> object. This is a design decision
that was taken to allow for easy coercion between an
<code>&lt;epichains&gt;</code> object obtained from
<code><a href="../reference/simulate_chains.html">simulate_chains()</a></code> and summaries of the
<code>&lt;epichains&gt;</code> object otherwise attainable by a separate
run of <code><a href="../reference/simulate_chain_stats.html">simulate_chain_stats()</a></code> with the same parameter
values passed to <code><a href="../reference/simulate_chains.html">simulate_chains()</a></code>.</p>
<p>Lastly, <code>&lt;epichains&gt;</code> objects have an
<code><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate()</a></code> method that aggregates the simulated outbreak
into cases by “generation” or “time”. This is syntactic sugar for the
<code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">dplyr::group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">dplyr::summarise()</a></code> style
of aggregation with the added benefit of not taking on
<code>dplyr</code> as a dependency to achieve the goal.</p>
<p>In summary, an <code>&lt;epichains&gt;</code> object has the
following structure:</p>
<ul>
<li>Columns:
<ul>
<li>
<code>chain</code> (<code>&lt;integer&gt;</code>)</li>
<li>
<code>infector</code> (<code>&lt;integer&gt;</code>)</li>
<li>
<code>infectee</code> (<code>&lt;integer&gt;</code>)</li>
<li>
<code>generation</code> (<code>&lt;integer&gt;</code>), and
optionally,</li>
<li>
<code>time</code> (<code>&lt;numeric&gt;</code>), if
<code>generation_time</code> is specified</li>
</ul>
</li>
<li>Attributes (See definitions in <a href="https://epiverse-trace.github.io/epichains/reference/simulate_chains.html">simulate_chains</a>):
<ul>
<li>
<code>n_chains</code>,</li>
<li>
<code>statistic</code>,</li>
<li>
<code>stat_threshold</code>,</li>
<li>
<code>offspring_dist</code>, and</li>
<li>
<code>track_pop</code> (if <code>pop</code> is finite, i.e., if
specified).</li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="likelihood-estimation">likelihood estimation<a class="anchor" aria-label="anchor" href="#likelihood-estimation"></a>
</h3>
<p>Likelihoods are estimated using the <code><a href="../reference/likelihood.html">likelihood()</a></code>
function. The function is designed to be flexible in two inputs:</p>
<ul>
<li>data can be supplied as a vector of chain summaries, a
<code>&lt;epichains&gt;</code> object, or a
<code>&lt;epichains_summary&gt;</code> object, and</li>
<li>the offspring distribution can be supplied as a function, allowing
the user to use a custom offspring distributions.</li>
</ul>
<p><code><a href="../reference/likelihood.html">likelihood()</a></code> uses either analytical or numerical methods
to estimate the likelihood of observing the input chain summaries. The
analytical methods are closed-form likelihoods that take the form
<code>.&lt;offspring_dist&gt;_&lt;statistic&gt;_ll()</code>, for
example, <code><a href="../reference/dot-gborel_size_ll.html">.gborel_size_ll()</a></code> and
<code><a href="../reference/dot-pois_length_ll.html">.pois_length_ll()</a></code> and are shipped in this package. If the
user supplies an offspring distribution and a statistic for which a
solution exists, internally, it is used. If not, simulations are used to
estimate the likelihood. The numerical likelihood simulation is achieved
using <code><a href="../reference/dot-offspring_ll.html">.offspring_ll()</a></code>, an internal wrapper around
<code><a href="../reference/simulate_chain_stats.html">simulate_chain_stats()</a></code>.</p>
<p>The output type of <code><a href="../reference/likelihood.html">likelihood()</a></code> depends on the
combination of the arguments <code>individual</code>,
<code>obs_prob</code>, and <code>nsim_obs</code> as summarised in the
table below:</p>
<table class="table">
<colgroup>
<col width="20%">
<col width="17%">
<col width="18%">
<col width="21%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th><code>individual</code></th>
<th><code>obs_prob</code></th>
<th>Output type</th>
<th>Output length</th>
<th>Element length</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>FALSE</code></td>
<td>1</td>
<td><code>&lt;numeric&gt;</code></td>
<td>1</td>
<td>NA</td>
</tr>
<tr class="even">
<td><code>FALSE</code></td>
<td>
<code>obs_prob</code> &gt;= 0 and <code>obs_prob</code> &lt;= 1</td>
<td><code>&lt;numeric&gt;</code></td>
<td><code>nsim_obs</code></td>
<td>NA</td>
</tr>
<tr class="odd">
<td><code>TRUE</code></td>
<td>1</td>
<td><code>&lt;list&gt;</code></td>
<td>1</td>
<td>input data</td>
</tr>
<tr class="even">
<td><code>TRUE</code></td>
<td>
<code>obs_prob</code> &gt;= 0 and <code>obs_prob</code> &lt;= 1</td>
<td><code>&lt;list&gt;</code></td>
<td><code>nsim_obs</code></td>
<td>input data</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="naming-and-documentation-style">Naming and documentation style<a class="anchor" aria-label="anchor" href="#naming-and-documentation-style"></a>
</h2>
<p>The package uses the following naming conventions:</p>
<ul>
<li><p>Functions and arguments are named using snake_case, example,
<code><a href="../reference/simulate_chains.html">simulate_chains()</a></code>.</p></li>
<li><p>Internal functions are prefixed with a period, for example,
<code><a href="../reference/dot-offspring_ll.html">.offspring_ll()</a></code>. This is only a visual cue and does not
have any technical implications.</p></li>
<li><p>In the documentation:</p></li>
<li><p>Classes and objects are enclosed in angle brackets, for example,
<code>&lt;epichains&gt;</code>.</p></li>
<li><p>Packages are enclosed in curly braces, for example,
<a href="https://github.com/epiverse-trace/epichains" class="external-link">epichains</a>.</p></li>
<li><p>All function arguments are defined in sentence case and
punctuated (especially with full stops).</p></li>
<li><p>Function titles are in imperative form.</p></li>
<li><p>Functions Are referred to with
<code>function_name()</code></p></li>
</ul>
</div>
<div class="section level2">
<h2 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a>
</h2>
<ul>
<li>Input validation:
<ul>
<li>
<a href="https://github.com/mllg/checkmate/" class="external-link">checkmate</a>: exports
many <code>test_*()</code>, <code>check_*()</code> and
<code>assert_*()</code> functions and is available on CRAN.</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="development-journey">Development journey<a class="anchor" aria-label="anchor" href="#development-journey"></a>
</h2>
<p>{epichains} is a successor to the <a href="https://github.com/epiverse-trace/bpmodels" class="external-link">bpmodels</a> package,
which will be retired when {epichains} is released.</p>
<p>{epichains} was born out of a need to refactor {bpmodels}, which led
to a name change and subsequent changes in design that would have
required significant disruptive changes to {bpmodels}. {epichains} is a
major refactoring of {bpmodels} to provide a simulation function that
accounts for susceptible depletion and population immunity without
restrictions on the offspring distributions, better function and long
form documentation, and an object-oriented approach to simulating and
handling transmission chains in R.</p>
<p>Future plans include simulation of contacts of infectees, the
incorporation of network effects, an object-oriented approach to
estimating chain size and length likelihoods, and interoperability with
the <a href="https://epiverse-trace.github.io/epiparameter/" class="external-link">{epiparameter}</a>
package for ease of setting up various epidemiological delays.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by James M. Azam, Sebastian Funk, Flavio Finger.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
