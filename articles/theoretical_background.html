<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Theoretical background for epichains ‚Ä¢ epichains</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Theoretical background for epichains">
<!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XZ471458FQ"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XZ471458FQ');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">
    <a href="https://epiverse-trace.github.io/" class="external-link"><img src="https://epiverse-trace.github.io/blueprints/logo_white.svg" id="logo" alt="Epiverse-TRACE"></a>
    <a class="navbar-brand me-2" href="../index.html">epichains</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/epichains.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Package vignettes</h6></li>
    <li><a class="dropdown-item" href="../articles/projecting_incidence.html">Projecting infectious disease incidence: a COVID-19 example</a></li>
    <li><a class="dropdown-item" href="../articles/interventions.html">Modelling disease control interventions</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Modelling guides and background</h6></li>
    <li><a class="dropdown-item" href="../articles/branching_process_literature.html">Literature on branching process applications</a></li>
    <li><a class="dropdown-item" href="../articles/theoretical_background.html">Theoretical background for epichains</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Developer Documentation</h6></li>
    <li><a class="dropdown-item" href="../articles/design-principles.html">Design Principles for {epichains}</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiverse-trace/epichains/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Theoretical background for epichains</h1>
                        <h4 data-toc-skip class="author">Sebastian Funk
and James Azam</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epiverse-trace/epichains/blob/main/vignettes/theoretical_background.Rmd" class="external-link"><code>vignettes/theoretical_background.Rmd</code></a></small>
      <div class="d-none name"><code>theoretical_background.Rmd</code></div>
    </div>

    
    
<p><em>epichains</em> provides methods to analyse and simulate the size
and length of branching processes with an arbitrary offspring
distribution. In this vignette we lay out the mathematical concepts
behind the functionality available in the package.</p>
<div class="section level2">
<h2 id="branching-processes">Branching processes<a class="anchor" aria-label="anchor" href="#branching-processes"></a>
</h2>
<p><a href="https://en.wikipedia.org/wiki/Branching_process" class="external-link">Branching
processes</a> are a class of models that are used to model the growth of
populations. They assume that each member of the population produces a
number of offspring,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>,
that is a random variable with probability mass function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Z</mi><mo>=</mo><mi>z</mi><mo stretchy="false" form="prefix">|</mo><mi>Œ∏</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(Z = z | \theta)</annotation></semantics></math>,
called the <em>offspring distribution</em>. Their use has a long history
in epidemiology, where the population is interpreted as a pathogen, and
the offspring as new hosts that it infects <span class="citation">(<a href="#ref-farrington2003">Farrington, Kanaan, and Gay 2003</a>)</span>.
Below we will call these infected individuals <em>cases</em> but the
methods could be applied in other contexts where branching processes are
to be used.</p>
</div>
<div class="section level2">
<h2 id="simulation">Simulation<a class="anchor" aria-label="anchor" href="#simulation"></a>
</h2>
<p>To simulate from a branching process, we start with a single case and
proceed in discrete steps or generations, drawing from the offspring
distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Z</mi><mo>=</mo><mi>z</mi><mo stretchy="false" form="prefix">|</mo><mi>Œ∏</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(Z=z | \theta)</annotation></semantics></math>
to generate new cases from each case.</p>
<p>Given an infector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
and infectee
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>,
we can additionally assign them a distribution of times
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>
that approximates when the infection event occurred. If we define
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>
as a random variable with distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo>;</mo><mi>Œ∏</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f(T = t; \theta)</annotation></semantics></math>
we can assign each case
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
a time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mi>j</mi></msub><annotation encoding="application/x-tex">t_{j}</annotation></semantics></math>
which, if case
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
has been affected by case
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
is given by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>j</mi></msub><mo>‚àí</mo><msub><mi>t</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>Œ∏</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f(t_{j} - t_{i} | \theta)</annotation></semantics></math>.
If we identify the timing of cases by the time of their symptom onset
this is the <a href="https://en.wikipedia.org/wiki/Serial_interval" class="external-link">serial
interval</a>, but depending on case definitions this could be another
interval.</p>
<div class="section level3">
<h3 id="summary-statistics">Summary statistics<a class="anchor" aria-label="anchor" href="#summary-statistics"></a>
</h3>
<p>Branching process simulations end when they have gone extinct, that
is, no more offspring are being produced, or because of some stopping
criterion. To summarise the simulations, we either study the
<em>size</em> or <em>length</em> of the resulting <em>chain</em> of
cases. The size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>S</mi><annotation encoding="application/x-tex">S</annotation></semantics></math>
of a chain is the number of cases that have occurred over the course of
the simulation including the initial case so that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>‚â•</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">S \geq 1</annotation></semantics></math>.
The length
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>L</mi><annotation encoding="application/x-tex">L</annotation></semantics></math>
of a chain is the number of generations that have been simulated
including the initial case so that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>‚â•</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">L \geq 1</annotation></semantics></math>.</p>
</div>
</div>
<div class="section level2">
<h2 id="inference">Inference<a class="anchor" aria-label="anchor" href="#inference"></a>
</h2>
<p>By characterising a chains of cases by their size of length we can
conduct inference to learn about the underlying parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ∏</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
from observation of chain sizes or chain lengths <span class="citation">(<a href="#ref-blumberg2013">Blumberg and Lloyd-Smith
2013</a>)</span>. In general this is only possible for
<em>subcritical</em> branching processes, i.e.¬†ones where the mean
number of offspring is less than 1, as otherwise the branching process
could grow forever. However, we can expand the theory to
<em>supercritical</em> branching processes, i.e.¬†ones where the mean
number of offspring is greater than 1, by defining a cut off of chain
size or length beyond which we treat the chain as if it had infinite
size or length, respectively.</p>
<div class="section level3">
<h3 id="size-and-length-distributions-for-some-offspring-distributions">Size and length distributions for some offspring distributions<a class="anchor" aria-label="anchor" href="#size-and-length-distributions-for-some-offspring-distributions"></a>
</h3>
<p>We show the equations for the size and length distributions for some
offspring distributions where they can be derived analytically: <a href="https://en.wikipedia.org/wiki/Poisson_distribution" class="external-link">Poisson</a>,
<a href="https://en.wikipedia.org/wiki/Negative_binomial_distribution" class="external-link">negative
binomial</a>, <a href="https://en.wikipedia.org/wiki/Geometric_distribution" class="external-link">geometric</a>,
and a <a href="https://en.wikipedia.org/wiki/Gamma_distribution" class="external-link">gamma</a>-<a href="https://en.wikipedia.org/wiki/Borel_distribution" class="external-link">Borel</a>
mixture.</p>
<div class="section level4">
<h4 id="negative-binomial-and-special-cases">Negative binomial and special cases<a class="anchor" aria-label="anchor" href="#negative-binomial-and-special-cases"></a>
</h4>
<p>If the offspring distribution is a Poisson distribution, we can
interpret its rate parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
as the basic reproduction number
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mn>0</mn></msub><annotation encoding="application/x-tex">R_{0}</annotation></semantics></math>
of the pathogen. In the more general case where the offspring definition
can be <em>overdispersed</em> leading to <em>superspreading</em> we can
use a negative binomial offspring distribution with mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œº</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
and overdispersion
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math><span class="citation">Blumberg and Lloyd-Smith (<a href="#ref-blumberg2013">2013</a>)</span>. In that case, the mean
parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œº</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
is interpreted as the basic reproduction number
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mn>0</mn></msub><annotation encoding="application/x-tex">R_0</annotation></semantics></math>
of the pathogen. The negative binomial distribution arises from a
Poisson-gamma mixture and thus a branching process with negative
binomial distributed offspring can be interpreted as one with Poisson
distributed offspring where the basic reproduction number
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mn>0</mn></msub><annotation encoding="application/x-tex">R_0</annotation></semantics></math>
itself varies according to a gamma distribution. The amount of variation
in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mn>0</mn></msub><annotation encoding="application/x-tex">R_0</annotation></semantics></math>
is then interpreted as individual-level variation in transmission
representing overdispersion or superspreading, and the degree to which
this happens is given by the overdispersion parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>.</p>
<div class="section level5">
<h5 id="size-distributions">Size distributions<a class="anchor" aria-label="anchor" href="#size-distributions"></a>
</h5>
<p>The probability
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
of a chain of size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>S</mi><annotation encoding="application/x-tex">S</annotation></semantics></math>
given
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mn>0</mn></msub><annotation encoding="application/x-tex">R_0</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
in a branching process with negative binomial offspring distribution is
given in Eq. 9 of <span class="citation">Blumberg and Lloyd-Smith (<a href="#ref-blumberg2013">2013</a>)</span></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>R</mi><mn>0</mn></msub><mo>,</mo><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>Œì</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mi>S</mi><mo>+</mo><mi>S</mi><mo>‚àí</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>Œì</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mi>S</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>Œì</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><msub><mi>R</mi><mn>0</mn></msub><mi>k</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>S</mi><mo>‚àí</mo><mn>1</mn></mrow></msup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mfrac><msub><mi>R</mi><mn>0</mn></msub><mi>k</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>k</mi><mi>S</mi><mo>+</mo><mi>S</mi><mo>‚àí</mo><mn>1</mn></mrow></msup></mfrac></mrow><annotation encoding="application/x-tex">
p(S|R_0, k) = \frac{\Gamma(kS + S - 1)}{\Gamma(kS)\Gamma(S + 1)} \frac{\left(\frac{R_0}{k}\right)^{S - 1}}{\left( 1 + \frac{R_0}{k} \right)^{kS + S - 1}}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œì</mi><annotation encoding="application/x-tex">\Gamma</annotation></semantics></math>
is the gamma function. In order to estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>S</mi><annotation encoding="application/x-tex">S</annotation></semantics></math>
from a given
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mn>0</mn></msub><annotation encoding="application/x-tex">R_0</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
we can define a likelihood function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>R</mi><mn>0</mn></msub><mo>,</mo><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">L(S) = p(S|R_0, k)</annotation></semantics></math>.
The corresponding log-likelihood is</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mrow><mi mathvariant="normal">L</mi><mi mathvariant="normal">L</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo></mtd><mtd columnalign="left" style="text-align: left"><mo>log</mo><mi>Œì</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mi>S</mi><mo>+</mo><mi>S</mi><mo>‚àí</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>log</mo><mi>Œì</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mi>S</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mo>log</mo><mi>Œì</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo>‚àí</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo>‚àí</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>log</mo><mfrac><msub><mi>R</mi><mn>0</mn></msub><mi>k</mi></mfrac><mo>‚àí</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><msub><mi>R</mi><mn>0</mn></msub><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo>‚àí</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mfrac><msub><mi>R</mi><mn>0</mn></msub><mi>k</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
\mathrm{LL}(S) = &amp;\log\Gamma(kS + S  - 1) - \left(\log\Gamma(kS) + \log\Gamma(S - 1) \right) \\
&amp; + (S-1) \log \frac{R_0}{k} - (SR_0 + (S - 1)) \log \left(1 + \frac{R_0}{k}\right)
\end{align}</annotation></semantics></math></p>
<p>The log-likelihood for Poisson distributed offspring follows from
this where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
tends to infinity (corresponding to Eq. 2.2 in <span class="citation">Farrington, Kanaan, and Gay (<a href="#ref-farrington2003">2003</a>)</span>)</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">L</mi><mi mathvariant="normal">L</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo>‚àí</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>log</mo><msub><mi>R</mi><mn>0</mn></msub><mo>‚àí</mo><mi>S</mi><msub><mi>R</mi><mn>0</mn></msub><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo>‚àí</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>log</mo><mi>S</mi><mo>‚àí</mo><mo>log</mo><mi>Œì</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\mathrm{LL}(S) = (S - 1) \log R_0 - S R_0 + (S - 2) \log S - \log\Gamma(S)
</annotation></semantics></math></p>
<p>In all cases the point estimate for the basic reproduction number
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><msub><mi>R</mi><mn>0</mn></msub><mo accent="true">ÃÇ</mo></mover><annotation encoding="application/x-tex">\hat{R_0}</annotation></semantics></math>
is related to the mean chain size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>S</mi><mo accent="true">‚Äæ</mo></mover><annotation encoding="application/x-tex">\bar{S}</annotation></semantics></math>
by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><msub><mi>R</mi><mn>0</mn></msub><mo accent="true">ÃÇ</mo></mover><mo>=</mo><mn>1</mn><mo>‚àí</mo><mfrac><mn>1</mn><mover><mi>S</mi><mo accent="true">‚Äæ</mo></mover></mfrac></mrow><annotation encoding="application/x-tex">
\hat{R_0} = 1 - \frac{1}{\bar{S}}
</annotation></semantics></math></p>
</div>
<div class="section level5">
<h5 id="length-distributions">Length distributions<a class="anchor" aria-label="anchor" href="#length-distributions"></a>
</h5>
<p>The cumulative mass function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>L</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">F(L)</annotation></semantics></math>
of observing a chain of length
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>L</mi><annotation encoding="application/x-tex">L</annotation></semantics></math>
when offspring is Poisson distributed is given by Eq. (2.5) in <span class="citation">Farrington, Kanaan, and Gay (<a href="#ref-farrington2003">2003</a>)</span> (there called ‚Äúoutbreak
duration‚Äù):</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>L</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mi>e</mi><mrow><mo>‚àí</mo><msub><mi>R</mi><mn>0</mn></msub></mrow></msup><msub><mi>E</mi><mi>L</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>e</mi><mrow><msub><mi>R</mi><mn>0</mn></msub><msup><mi>e</mi><mrow><mo>‚àí</mo><msub><mi>R</mi><mn>0</mn></msub></mrow></msup></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
F(L) = e^{-R_0} E_L \left( e^{R_0 e^{-R_0} } \right)
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mi>L</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">E_L(x)</annotation></semantics></math>
is the iterated exponential function,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">E_0(x) = 1</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mi>x</mi><mrow><msub><mi>E</mi><mi>L</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msup></mrow><annotation encoding="application/x-tex">E_{L + 1}(x) = x^{E_L(x)}</annotation></semantics></math>.</p>
<p>For geometric distributed offspring (corresponding to a negative
Binomial with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k=1</annotation></semantics></math>)
this function is given by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>L</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mn>1</mn><mo>‚àí</mo><msubsup><mi>R</mi><mn>0</mn><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msubsup></mrow><mrow><mn>1</mn><mo>‚àí</mo><msubsup><mi>R</mi><mn>0</mn><mrow><mi>L</mi><mo>‚àí</mo><mn>2</mn></mrow></msubsup></mrow></mfrac></mrow><annotation encoding="application/x-tex">
F(L) = \frac{ 1- R_0^{L + 1} } {1 - R_0^{L - 2}}
</annotation></semantics></math></p>
<p>In both cases
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>L</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f(L)</annotation></semantics></math>
denotes cumulative mass functions and therefore the probability of
observing a chain of length
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>L</mi><annotation encoding="application/x-tex">L</annotation></semantics></math>
is therefore
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>L</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>L</mi><mo>‚àí</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f(L) - f(L - 1)</annotation></semantics></math>.</p>
</div>
</div>
<div class="section level4">
<h4 id="gamma-borel-mixture">Gamma-Borel mixture<a class="anchor" aria-label="anchor" href="#gamma-borel-mixture"></a>
</h4>
<p>The probability distribution of outbreak sizes from a branching
process with a Poisson offspring distribution (Eq. 2.2 in <span class="citation">Farrington, Kanaan, and Gay (<a href="#ref-farrington2003">2003</a>)</span>) is a special case of the <a href="https://en.wikipedia.org/wiki/Borel_distribution#Borel%E2%80%93Tanner_distribution" class="external-link">Borel-Tanner
distribution</a> starting with 1 individual. An alternative to the
negative binomial offspring distribution which represents a
Poisson-gamma mixture is a Borel-gamma mixture. This could represent
situations where the variation is not at the <em>individual level</em>
but at the <em>chain level</em>, i.e.¬†transmission chains is homogeneous
but there is heterogeneity between chains. In that case, it can be shown
that the resulting log-likelihood of chain sizes is</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mrow><mi mathvariant="normal">L</mi><mi mathvariant="normal">L</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo></mtd><mtd columnalign="left" style="text-align: left"><mo>log</mo><mi>Œì</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo>+</mo><mi>S</mi><mo>‚àí</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>log</mo><mi>Œì</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mo>log</mo><mi>Œì</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo>‚àí</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>log</mo><mi>S</mi><mo>‚àí</mo><mi>k</mi><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo>+</mo><mfrac><msub><mi>R</mi><mn>0</mn></msub><mi>k</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
\mathrm{LL}(S) = &amp;\log\Gamma(k + S - 1) - \left(\log\Gamma(k) + \log\Gamma(S + 1) \right) \\
&amp; + (S-1) \log S - k \log \left(S + \frac{R_0}{k}\right)
\end{align}</annotation></semantics></math></p>
</div>
</div>
<div class="section level3">
<h3 id="numerical-approximations-of-chain-size-and-length-distributions">Numerical approximations of chain size and length distributions<a class="anchor" aria-label="anchor" href="#numerical-approximations-of-chain-size-and-length-distributions"></a>
</h3>
<p>When analytic likelihoods are not available a numerical approximation
is used to derive the distributions. In order to do this, the simulation
functionality is be used to generate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
simulated chains and the value of the cumulative mass function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo stretchy="false" form="prefix">|</mo><mi>Œ∏</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(S|\theta)</annotation></semantics></math>
at the observed
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>S</mi><annotation encoding="application/x-tex">S</annotation></semantics></math>
approximated by the empirical cumulative distribution function:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo stretchy="false" form="prefix">|</mo><mi>Œ∏</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚âà</mo><munder><mo>‚àë</mo><mi>i</mi></munder><mn>ùüè</mn><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>&lt;</mo><mo>=</mo><mi>S</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
P(S|\theta) \approx \sum_i \mathbf{1}(x_i &lt;= S)
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>ùüè</mn><annotation encoding="application/x-tex">\mathbf{1}</annotation></semantics></math>
is the indicator function and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>i</mi></msub><annotation encoding="application/x-tex">x_i</annotation></semantics></math>
the i-th observed chain size (or length, if the interest is in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>L</mi><annotation encoding="application/x-tex">L</annotation></semantics></math>).
In order to improve this approximation a linear approximation is applied
to the values of the empirical distribution function (at the expense of
normalisation to 1).</p>
<p>The (unnormalised) probability of observing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>S</mi><annotation encoding="application/x-tex">S</annotation></semantics></math>
is then given by
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo stretchy="false" form="prefix">|</mo><mi>Œ∏</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo stretchy="false" form="prefix">|</mo><mi>Œ∏</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo>‚àí</mo><mn>1</mn><mo stretchy="false" form="prefix">|</mo><mi>Œ∏</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
p(S|\theta) = P(S|\theta) - P(S - 1|\theta)
</annotation></semantics></math> and a an equivalent relationship is
used for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>L</mi><annotation encoding="application/x-tex">L</annotation></semantics></math>.</p>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-blumberg2013" class="csl-entry">
Blumberg, S., and J. O. Lloyd-Smith. 2013. <span>‚ÄúComparing Methods for
Estimating R0 from the Size Distribution of Subcritical Transmission
Chains.‚Äù</span> <em>Epidemics</em> 5 (3): 131‚Äì45. <a href="https://doi.org/10.1016/j.epidem.2013.05.002" class="external-link">https://doi.org/10.1016/j.epidem.2013.05.002</a>.
</div>
<div id="ref-farrington2003" class="csl-entry">
Farrington, C. P., M. N. Kanaan, and N. J. Gay. 2003. <span>‚ÄúBranching
Process Models for Surveillance of Infectious Diseases Controlled by
Mass Vaccination.‚Äù</span> <em>Biostatistics (Oxford, England)</em> 4
(2): 279‚Äì95. <a href="https://doi.org/10.1093/biostatistics/4.2.279" class="external-link">https://doi.org/10.1093/biostatistics/4.2.279</a>.
</div>
<div id="ref-lloyd-smith2005" class="csl-entry">
Lloyd-Smith, J. O., S. J. Schreiber, P. E. Kopp, and W. M. Getz. 2005.
<span>‚ÄúSuperspreading and the Effect of Individual Variation on Disease
Emergence.‚Äù</span> <em>Nature</em> 438 (7066): 355‚Äì59. <a href="https://doi.org/10.1038/nature04153" class="external-link">https://doi.org/10.1038/nature04153</a>.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by James M. Azam, Sebastian Funk, Flavio Finger.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
