---
title: "Design Principles for {epichains}"
subtitle: "An R package for simulating, handling, and analysing transmission chains in R"
pkgdown:
  as_is: true
bibliography: references.json
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Design Principles for {epichains}}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette outlines the design decisions that have been taken during the development of the {epichains} R package, and provides some of the reasoning, and possible pros and cons of each decision.

This document is primarily intended to be read by those interested in understanding the code within the package and for potential package contributors.

## Scope

{epichains} aims to provide four three functionalities:

* Branching process models for simulating transmission chains using the
`simulate_tree()` and `simulate_summary()` functions,
* Modelling of the offspring distribution using shipped mixture distributions
like `rborel()`.
* Estimation of the likelihood of
observing transmission chains of given sizes or lengths. This can be achieved
in two ways:
  - Closed form or analytical likelihoods that take the form <distribution>_<chain_statistic_type_ll>, for example,
`gborel_size_ll()` and `pois_length_ll()`.
  - Simulation using `offspring_ll()`.

## Input/Output/Interoperability

`simulate_tree()` returns an `<epichains_tree>` object that stores both
the simulated output and parameter values used to achieve the simulation.
`print()` and `summary()` methods are implemented for the `<epichains_tree>`
class to help return insightful output based on the simulated transmission
chains. Future support will be provided for `<epidist>` objects from the
{epiparameter} package to allow for interoperability. Storing
inputs and outputs in the `<epichains_tree>` object eases the extra work
needed to be done by the user to set up scenario analyses.

`simulate_summary()` returns a vector.

## Design decisions

### `<epichains_tree>` class

* Objects of this class have attributes to store simulation
  metadata (all inputs, including `statistic`,`stat_max`,
  `offspring_dist`, `generation_time`, `pop_size`, e.t.c.,).

* Columns of `<epichains_tree>`: 
  * `generation_time` (numeric)
  * `infector_id` (factor) 
  * `infectee_id` (factor) 
  * `generation` (integer)

### Methods

* `print.epichains_tree()`: function to format and pretty 
print `<epichains_tree>` objects.

* `summary.epichains_tree()`: function to summarise an
`<epichains_tree>` into the eventual outcome of the chain statistic simulated,
and with the same length as the index cases. All values above `stat_max`
are set to `Inf` with the same logic as in `simulate_summary()`.

* `aggregate.epichains_tree()`: function to aggregate the simulated
chains into cases by "generation" or "time", if it was simulated.

## Dependencies

* Input validation:
  - [checkmate](https://github.com/mllg/checkmate/): exports many `test_*()`,
  `check_*()` and `assert_*()` functions and is available on CRAN.

## Development journey

{epichains} is a successor to the [bpmodels](https://github.com/epiverse-trace/bpmodels) #nolint package, which had the same functionality but not structured in an
object-oriented manner. The package was developed to provide a more structured
and object-oriented approach to simulating and handling transmission
chains in R.
